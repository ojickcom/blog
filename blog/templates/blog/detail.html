{% extends 'base.html' %} 

 {% block title %}{{ blog.title }}{% endblock %} 

 {% block content %} 
 <div class="card mb-4"> 
      <div class="card-body"> 
           {# blog.title ëŒ€ì‹  blog.b_titleì„ í‘œì‹œ #} 
           <h1 class="card-title" 
               style="height: 3.5em; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
               {{ blog.b_title }}
           </h1> 
           <div class="d-flex justify-content-between align-items-center text-muted mb-3"> 
                <small>ğŸ“… {{ blog.written_date|date:"Y-m-d" }}</small> 
                <small>ğŸ“ {{ blog.place_name }}</small> 
           </div> 
           
           {# ê¸°ì¡´ ì´ë¯¸ì§€ í‘œì‹œ ì˜ì—­ ì œê±°ë¨ #} 

           <hr> 

           {# ìƒˆë¡œìš´ ì •ë³´ í‘œì‹œ ë° ë³µì‚¬ ë²„íŠ¼ ì„¹ì…˜ #} 
           <div class="mb-4 p-3 border rounded bg-light"> 
                <h5 class="mb-3">ğŸ“„ ë¸”ë¡œê·¸ ì •ë³´</h5> 

                {# ë¸”ë¡œê·¸ ì œëª© (b_title) í‘œì‹œ ë° ë³µì‚¬ ë²„íŠ¼ #} 
                <div class="d-flex align-items-center mb-2"> 
                    <strong class="me-2">ì œëª©:</strong> 
                    {# blog.title ëŒ€ì‹  blog.b_titleì„ í‘œì‹œ #} 
                    <span id="display-title-text" class="flex-grow-1 text-break" 
                          style="height: 3em; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                        {{ blog.b_title }}
                    </span> 
                    <button type="button" class="btn btn-sm btn-outline-secondary ms-2 copy-btn" data-target-id="display-title-text"> 
                        ğŸ“‹ ë³µì‚¬ <span class="ms-1 copy-feedback" style="display: none;">(ë³µì‚¬ë¨!)</span> 
                    </button> 
                </div> 

                {# í´ë¼ì´ì–¸íŠ¸ ì´ë¯¸ì§€ URL í‘œì‹œ ë° ë³µì‚¬ ë²„íŠ¼ #} 
                {% if blog.client and blog.client.image_url %} 
                <div class="d-flex align-items-center mb-2"> 
                    <strong class="me-2">ì´ë¯¸ì§€ URL:</strong> 
                    <span id="display-image-url-text" class="flex-grow-1 text-break">{{ blog.client.image_url }}</span> 
                    <button type="button" class="btn btn-sm btn-outline-secondary ms-2 copy-btn" data-target-id="display-image-url-text"> 
                        ğŸ“‹ ë³µì‚¬ <span class="ms-1 copy-feedback" style="display: none;">(ë³µì‚¬ë¨!)</span> 
                    </button> 
                </div> 
                {% endif %} 

                {# í´ë¼ì´ì–¸íŠ¸ ì´ë¦„ í‘œì‹œ ë° ë³µì‚¬ ë²„íŠ¼ #} 
                {% if blog.client %} 
                <div class="d-flex align-items-center mb-2"> 
                    <strong class="me-2">í´ë¼ì´ì–¸íŠ¸ ì´ë¦„:</strong> 
                    <span id="display-client-name-text" class="flex-grow-1 text-break">{{ blog.client.name }}</span> 
                    <button type="button" class="btn btn-sm btn-outline-secondary ms-2 copy-btn" data-target-id="display-client-name-text"> 
                        ğŸ“‹ ë³µì‚¬ <span class="ms-1 copy-feedback" style="display: none;">(ë³µì‚¬ë¨!)</span> 
                    </button> 
                </div> 
                {% endif %} 

                {# ë¸”ë¡œê·¸ ë‚´ìš© ë³µì‚¬ ë²„íŠ¼ ì¶”ê°€ #} 
                <div class="d-flex align-items-start mb-2"> {# Use align-items-start for multiline content #} 
                    <strong class="me-2">ë‚´ìš©:</strong> 
                    {# ë‚´ìš©ì„ ìˆ¨ê²¨ì§„ spanì— ë„£ì–´ ë³µì‚¬ ëŒ€ìƒì´ ë˜ë„ë¡ í•¨ #} 
                    <span id="display-content-text" style="display: none;">{{ blog.content }}</span>  
                    {# ì‹¤ì œ ë³´ì´ëŠ” ë‚´ìš©ì€ ì•„ë˜ <p> íƒœê·¸ì—ì„œ linebreaksbr í•„í„°ì™€ í•¨ê»˜ í‘œì‹œ #} 
                    <button type="button" class="btn btn-sm btn-outline-secondary ms-auto copy-btn" data-target-id="display-content-text"> 
                        ğŸ“‹ ë‚´ìš© ë³µì‚¬í•˜ê¸° <span class="ms-1 copy-feedback" style="display: none;">(ë³µì‚¬ë¨!)</span> 
                    </button> 
                </div> 
                
                {# ê¸€ì‘ì„± ì™„ë£Œ ë²„íŠ¼ ì¶”ê°€ #}
                <div class="d-flex justify-content-center mt-3">
                    {% if blog.blog_write %}
                        <span class="badge bg-success fs-6 px-3 py-2">âœ… ê¸€ì‘ì„± ì™„ë£Œë¨</span>
                    {% else %}
                        <button type="button" id="complete-btn" class="btn btn-success" data-blog-id="{{ blog.pk }}">
                            âœ… ê¸€ì‘ì„± ì™„ë£Œ 
                            <span id="complete-feedback" class="ms-1" style="display: none;">(ì™„ë£Œë¨!)</span>
                        </button>
                    {% endif %}
                </div>
           </div> 
           {# END ìƒˆë¡œìš´ ì •ë³´ í‘œì‹œ ë° ë³µì‚¬ ë²„íŠ¼ ì„¹ì…˜ #} 

           <hr> 
           {# ë¸”ë¡œê·¸ ë‚´ìš©ì€ ì—¬ì „íˆ ë³„ë„ì˜ <p> íƒœê·¸ì— í‘œì‹œë©ë‹ˆë‹¤. #} 
           <p class="card-text"> 
                {{ blog.content|linebreaksbr }} 
           </p> 
      </div> 
 </div> 

 <div class="d-flex justify-content-end"> 
      <a href="{% url 'blog_list_pending' %}" class="btn btn-secondary">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a> 
 </div> 

 <script> 
 document.addEventListener('DOMContentLoaded', function() { 
      const copyButtons = document.querySelectorAll('.copy-btn'); 
      const completeBtn = document.getElementById('complete-btn');

      // ë³µì‚¬ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” í•¨ìˆ˜ 
      function copyTextToClipboard(text, feedbackElement) { 
          const tempTextArea = document.createElement('textarea'); 
          tempTextArea.value = text; 
          document.body.appendChild(tempTextArea); 
          tempTextArea.select(); 
          
          try { 
              const successful = document.execCommand('copy'); 
              if (successful) { 
                  if (feedbackElement) { 
                      feedbackElement.style.display = 'inline'; // "ë³µì‚¬ë¨!" ë©”ì‹œì§€ í‘œì‹œ 
                      setTimeout(() => { 
                          feedbackElement.style.display = 'none'; // 2ì´ˆ í›„ ìˆ¨ê¹€ 
                      }, 2000); 
                  } 
              } else { 
                  console.warn('Fallback: Copying text command was unsuccessful.'); 
                  // alert('í…ìŠ¤íŠ¸ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”: \n' + text); // Canvas í™˜ê²½ì—ì„œ alert ì‚¬ìš© ê¸ˆì§€ 
              } 
          } catch (err) { 
              console.error('Fallback: Oops, unable to copy', err); 
              // alert('í…ìŠ¤íŠ¸ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”: \n' + text); // Canvas í™˜ê²½ì—ì„œ alert ì‚¬ìš© ê¸ˆì§€ 
          } finally { 
              document.body.removeChild(tempTextArea); 
          } 
      } 

      // ë³µì‚¬ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      copyButtons.forEach(button => { 
          button.addEventListener('click', function() { 
              const targetId = this.dataset.targetId; 
              const targetElement = document.getElementById(targetId); 
              const feedbackElement = this.querySelector('.copy-feedback'); // ë²„íŠ¼ ë‚´ì˜ í”¼ë“œë°± span 

              if (targetElement) { 
                  copyTextToClipboard(targetElement.textContent.trim(), feedbackElement); 
              } 
          }); 
      }); 
      
      // ê¸€ì‘ì„± ì™„ë£Œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      if (completeBtn) {
          completeBtn.addEventListener('click', function() {
              const blogId = this.dataset.blogId;
              const feedbackElement = document.getElementById('complete-feedback');
              
              // AJAX ìš”ì²­ìœ¼ë¡œ blog_writeë¥¼ trueë¡œ ë³€ê²½
              fetch(`{% url 'blog_complete' 0 %}`.replace('0', blogId), {
                  method: 'POST',
                  headers: {
                      'X-CSRFToken': '{{ csrf_token }}',
                      'Content-Type': 'application/json',
                  },
              })
              .then(response => response.json())
              .then(data => {
                  if (data.status === 'success') {
                      // ë²„íŠ¼ì„ ì„±ê³µ ìƒíƒœë¡œ ë³€ê²½
                      this.innerHTML = 'âœ… ê¸€ì‘ì„± ì™„ë£Œë¨';
                      this.classList.remove('btn-success');
                      this.classList.add('btn-secondary');
                      this.disabled = true;
                      
                      // í”¼ë“œë°± ë©”ì‹œì§€ í‘œì‹œ
                      feedbackElement.style.display = 'inline';
                      setTimeout(() => {
                          feedbackElement.style.display = 'none';
                      }, 3000);
                  }
              })
              .catch(error => {
                  console.error('Error:', error);
              });
          });
      }
 }); 
 </script> 
 {% endblock %}